[gd_scene format=3 uid="uid://cuchkd1bb0ruu"]

[ext_resource type="Script" uid="uid://mudgnftdwdja" path="res://scenes/ui/upgrade-card/upgrade_card.gd" id="1_4nc74"]
[ext_resource type="Texture2D" uid="uid://b8c7nwojwfvd8" path="res://assets/generic/9-rect.png" id="1_dvvti"]
[ext_resource type="Texture2D" uid="uid://bf3xc33cdype4" path="res://assets/upgrades/max-health.png" id="2_8apik"]
[ext_resource type="Texture2D" uid="uid://cvo0sgiikntfg" path="res://assets/upgrades/health.png" id="2_rvt4l"]
[ext_resource type="Texture2D" uid="uid://bxtc5illu43wy" path="res://assets/generic/circle-big.png" id="3_a8aqt"]
[ext_resource type="FontFile" uid="uid://ce3pxfpd38a3y" path="res://assets/fonts/monogram.ttf" id="3_jp4y4"]
[ext_resource type="Texture2D" uid="uid://b0fjfe6nt0lo8" path="res://assets/upgrades/dash.png" id="3_kawx0"]
[ext_resource type="Texture2D" uid="uid://rw6xdn4d86cl" path="res://assets/upgrades/dash-speed.png" id="4_pomno"]
[ext_resource type="Texture2D" uid="uid://cji07qxff22yy" path="res://assets/upgrades/attack-speed.png" id="5_y5gqa"]
[ext_resource type="Texture2D" uid="uid://vaj4khf5tx8e" path="res://assets/upgrades/regen.png" id="6_8apik"]
[ext_resource type="Texture2D" uid="uid://cc6p6t082a8en" path="res://assets/ui/border-2.png" id="6_pomno"]
[ext_resource type="Texture2D" uid="uid://dpst5o6lgdqja" path="res://assets/ui/border-1.png" id="6_y5gqa"]
[ext_resource type="Texture2D" uid="uid://bn8siqri4e6vf" path="res://assets/ui/border-3.png" id="7_y5gqa"]

[sub_resource type="Shader" id="Shader_xtnkb"]
code = "shader_type canvas_item;
uniform vec4 innerColor: source_color = vec4(0,0,0,1);
uniform vec4 outerColor: source_color = vec4(0,0,0,1);

uniform float scale = 5.0;
uniform float timeMod = 3.0;
uniform float pixelation = 10.0;
uniform float bold = 10.0;
uniform float sharp = 10.0;
uniform float moveSpeed = 1.0;

uniform vec2 focusPoint = vec2(0.5,0.5);

#define iTime (TIME*timeMod)

float rand(vec2 co) {
    // Dot product with large primes, sine, and fract to scramble bits
    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453123);
}

vec4 permute(vec4 x) {
    return mod(((x * 34.0) + 1.0) * x, 289.0);
}

vec2 fade(vec2 t) {
    // Fade curve for smooth interpolation
    return t * t * t * (t * (t * 6.0 - 15.0) + 10.0);
}

float perlinNoise(vec2 P) {
    // Grid cell coordinates
    vec2 Pi = floor(P);
    vec2 Pf = P - Pi;
    Pi = mod(Pi, 289.0);

    // Permutation
    vec4 ix = vec4(Pi.x, Pi.x + 1.0, Pi.x, Pi.x + 1.0);
    vec4 iy = vec4(Pi.y, Pi.y, Pi.y + 1.0, Pi.y + 1.0);

    vec4 i = permute(permute(ix) + iy);

    // Gradients: 8 directions
    vec4 gx = fract(i / 41.0) * 2.0 - 1.0;
    vec4 gy = abs(gx) - 0.5;
    vec4 tx = floor(gx + 0.5);
    gx = gx - tx;

    vec2 g00 = vec2(gx.x, gy.x);
    vec2 g10 = vec2(gx.y, gy.y);
    vec2 g01 = vec2(gx.z, gy.z);
    vec2 g11 = vec2(gx.w, gy.w);

    // Compute noise contributions from each corner
    vec2 fade_xy = fade(Pf);
    float n00 = dot(g00, Pf);
    float n10 = dot(g10, Pf - vec2(1.0, 0.0));
    float n01 = dot(g01, Pf - vec2(0.0, 1.0));
    float n11 = dot(g11, Pf - vec2(1.0, 1.0));

    // Interpolate
    float nx0 = mix(n00, n10, fade_xy.x);
    float nx1 = mix(n01, n11, fade_xy.x);
    float nxy = mix(nx0, nx1, fade_xy.y);

    return bold * nxy; // Scale to roughly [-1, 1]
}

vec4 shade(float degree){
	return mix(innerColor,outerColor, floor(degree*sharp)/sharp);
}

float pattern(vec2 uv){
	return perlinNoise(uv + perlinNoise(uv+perlinNoise(uv-iTime+1.0)-0.0) + iTime*moveSpeed)/(1.0);
}

void fragment()
{
	//vec2 focusPoint = vec2(0.3*sin(TIME)+0.5,0.2*cos(TIME)+0.5);
	
	
	vec2 px=pixelation*SCREEN_PIXEL_SIZE;
	vec2 uv = (floor(UV/px)*px);
	
	float focusMod = clamp((1.0-(1.0/(distance(uv, focusPoint)*50.0))), 0, 1);
	uv = uv*focusMod;
	
	
	COLOR = shade(pattern(scale*uv + iTime*moveSpeed));
	if (pow(UV.x-0.5,2) + pow(UV.y-0.5,2) > 0.25){
		COLOR.a = 0.0;
	}
		
}"

[sub_resource type="ShaderMaterial" id="ShaderMaterial_i3a2d"]
shader = SubResource("Shader_xtnkb")
shader_parameter/innerColor = Color(0.2231029, 0.22310287, 0.22310293, 1)
shader_parameter/outerColor = Color(0.4817894, 0.48178953, 0.4817894, 1)
shader_parameter/scale = 3.12
shader_parameter/timeMod = 0.2
shader_parameter/pixelation = 0.3
shader_parameter/bold = 2.0
shader_parameter/sharp = 4.0
shader_parameter/moveSpeed = 1.0
shader_parameter/focusPoint = Vector2(0.5, 0.5)

[node name="UpgradeCard" type="Control" unique_id=122037931]
process_mode = 3
custom_minimum_size = Vector2(88, 120)
layout_mode = 3
anchors_preset = 0
offset_right = 88.0
offset_bottom = 120.0
pivot_offset = Vector2(44, 60)
script = ExtResource("1_4nc74")
health_icon = ExtResource("2_8apik")
speed_icon = ExtResource("3_kawx0")
dash_speed_icon = ExtResource("4_pomno")
attack_speed_icon = ExtResource("5_y5gqa")
health_regen_icon = ExtResource("2_rvt4l")
regen_amt_icon = ExtResource("6_8apik")
border_1 = ExtResource("6_y5gqa")
border_2 = ExtResource("6_pomno")
border_3 = ExtResource("7_y5gqa")

[node name="NinePatchRect" type="NinePatchRect" parent="." unique_id=1130804198]
self_modulate = Color(0.2231029, 0.2231029, 0.22310287, 1)
material = SubResource("ShaderMaterial_i3a2d")
layout_mode = 0
offset_right = 88.0
offset_bottom = 120.0
texture = ExtResource("1_dvvti")
patch_margin_left = 16
patch_margin_top = 16
patch_margin_right = 16
patch_margin_bottom = 16

[node name="CenterContainer" type="CenterContainer" parent="NinePatchRect" unique_id=363744742]
layout_mode = 1
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2

[node name="HBoxContainer" type="VBoxContainer" parent="NinePatchRect/CenterContainer" unique_id=1769781262]
custom_minimum_size = Vector2(80, 0)
layout_mode = 2
theme_override_constants/separation = 8

[node name="Icon" type="TextureRect" parent="NinePatchRect/CenterContainer/HBoxContainer" unique_id=1466559335]
layout_mode = 2
texture = ExtResource("3_a8aqt")
stretch_mode = 3

[node name="Label" type="RichTextLabel" parent="NinePatchRect/CenterContainer/HBoxContainer" unique_id=987815616]
layout_mode = 2
mouse_filter = 1
theme_override_fonts/normal_font = ExtResource("3_jp4y4")
bbcode_enabled = true
text = "hey sup"
fit_content = true
horizontal_alignment = 1

[node name="Border" type="NinePatchRect" parent="." unique_id=1698656419]
layout_mode = 0
offset_left = -2.0
offset_top = -2.0
offset_right = 90.0
offset_bottom = 122.0
texture = ExtResource("6_y5gqa")
patch_margin_left = 26
patch_margin_top = 26
patch_margin_right = 26
patch_margin_bottom = 26
axis_stretch_horizontal = 1
axis_stretch_vertical = 1

[connection signal="gui_input" from="." to="." method="_on_gui_input"]
[connection signal="mouse_entered" from="." to="." method="_on_mouse_entered"]
[connection signal="mouse_exited" from="." to="." method="_on_mouse_exited"]
